{% extends "base.html" %}
{% load display_extras %}
{% load monitoring_extras %}
{# kate: space-indent on; indent-width 2; replace-tabs on; hl Django HTML Template; #}
{% block title %}{% for checkparam in check.checkparameter_set.all %}{{ checkparam.parameter|display }}: {{ checkparam.value }} &mdash; {{ check.target_host|display:"fqdn" }} &mdash; Fluxmon{% endfor %}{% endblock %}
{% block content %}
<ol class="breadcrumb">
  <li><a href="{% url 'hosts.views.domains' %}">Hosts</a></li>
  <li>
    <a href="{% url 'hosts.views.host' check.target_host.fqdn %}">{{ check.target_host|display:"fqdn" }}</a>
    {% if check.target_host != check.exec_host %}(as seen by <a href="{% url 'hosts.views.host' check.exec_host.fqdn %}">{{ check.exec_host|display:"fqdn" }}</a>){% endif %}
  </li>
  <li class="active">{{ check|display:"uuid" }}</li>
</ol>
{% include "monitoring/checkinfo.inc.html" %}
<div class="panel panel-default">
  <div class="panel-body">
    <ul class="nav nav-tabs">
      <li class="active"><a href="#variables" data-toggle="tab">Variables</a></li>
      {% ifperm "a" on check %}
      <li><a href="#acls"      data-toggle="tab">ACLs</a></li>
      {% endifperm %}
      {% ifperm "s" on check %}
      <li><a href="#share"     data-toggle="tab">Share</a></li>
      {% endifperm %}
    </ul>

    <div class="tab-content">
      <div class="tab-pane active" id="variables">
        <table class="table table-hover">
          <tbody>
          {% for view in views %}
            <tr targetlink="{% url 'monitoring.views.render_view_page' check.uuid view.id %}" class="checktr">
              <td>
                {{ view.name }}
              </td>
              <td><a href="{% url 'monitoring.views.render_view_page' check.uuid view.id %}" title="View graph" style="text-decoration: none">→</a></td>
            </tr>
          {% endfor %}
          </tbody>
        </table>

        <table class="table table-hover">
          <tbody>
          {% for variable, alerts in vars %}
            <tr targetlink="{% url 'monitoring.views.render_check_page' check.uuid variable.name %}" class="checktr {% if alerts %}warning{% else %}success{% endif %}">
              <td>
                {{ variable|display }}
              </td>
              <td><a href="{% url 'monitoring.views.render_check_page' check.uuid variable.name %}" title="View graph" style="text-decoration: none">→</a></td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="tab-pane" id="acls">
        {% include "monitoring/aclstab.inc.html" with object=check %}
      </div>

      {% ifperm "s" on check %}
      <div class="tab-pane" id="share">
        <div class="panel-heading">
          <h3 class="panel-title">Create a sharing key</h3>
        </div>
        <form class="form-horizontal" role="form">
          <div class="form-group">
            <label for="inputName" class="col-sm-2 control-label">Name</label>
            <div class="col-sm-10">
              <input class="form-control" id="inputName" placeholder="Name">
            </div>
          </div>
          <div class="form-group">
            <label for="inputDuration" class="col-sm-2 control-label">Duration</label>
            <div class="col-sm-10">
              <select class="form-control">
                <option value="    600">10 minutes</option>
                <option value="   3600">1 hour</option>
                <option value="  86400" selected="selected">1 day</option>
                <option value=" 604800">1 week</option>
                <option value="1209600">2 weeks</option>
                <option value="2592000">1 month</option>
                <option value="      0">unlimited</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <button type="submit" class="btn btn-default">Create key</button>
            </div>
          </div>
        </form>
      </div>
      {% endifperm %}
    </div>
  </div>
</div>
<script type="text/javascript">
$(".checktr").click(function(ev){
  ev.preventDefault();
  ev.stopPropagation();
  if(ev.ctrlKey){
    window.open(this.attributes.targetlink.value);
  }
  else{
    window.location = this.attributes.targetlink.value;
  }
});
</script>
{% endblock %}
